(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{274:function(t,s,a){t.exports=a.p+"assets/img/base-node.8ec63fad.png"},275:function(t,s,a){t.exports=a.p+"assets/img/base-deployment.5976577b.png"},276:function(t,s,a){t.exports=a.p+"assets/img/base-pod.f8384ac3.png"},277:function(t,s,a){t.exports=a.p+"assets/img/base-service.38ac0022.png"},360:function(t,s,a){"use strict";a.r(s);var e=a(14),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"k8s概念"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s概念"}},[t._v("#")]),t._v(" k8s概念")]),t._v(" "),s("p",[t._v("类比关系表")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("k8s组件")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("云计算系统")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("container 容器")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("进程")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("image 镜像")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v(".exe安装包")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("kubernetes")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("OS 操作系统")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("pod")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("虚拟机")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}}),t._v(" "),s("td",{staticStyle:{"text-align":"center"}})])])]),t._v(" "),s("h2",{attrs:{id:"node"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#node"}},[t._v("#")]),t._v(" node")]),t._v(" "),s("ul",[s("li",[t._v("node节点，可以是物理机也可以是私有云公有云的虚拟机。")]),t._v(" "),s("li",[t._v("一个node节点能运行多个pod，k8s就是将pod调度到健康的node上面运行。")]),t._v(" "),s("li",[t._v("每个node上都有kubelet：管理node，而且是node与master通信的代理")]),t._v(" "),s("li",[t._v("每个node上都有容器运行时docker或containerd或rkt")])]),t._v(" "),s("p",[t._v("node节点一般分为：")]),t._v(" "),s("ul",[s("li",[t._v("master管理节点")]),t._v(" "),s("li",[t._v("worker工作节点")])]),t._v(" "),s("p",[s("strong",[t._v("master")]),t._v("：kube-apiserver、kube-controller-manager和kube-scheduler。负载资源管理，pod调度，弹性伸缩，安全控制，系统监控，纠错等等")]),t._v(" "),s("p",[s("strong",[t._v("worker")]),t._v("：kubelet，kube-proxy。负责Pod的创建、启动、监控、重启、销毁，以及实现软件模式的负载均衡器。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(274),alt:""}})]),t._v(" "),s("h2",{attrs:{id:"deployment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deployment"}},[t._v("#")]),t._v(" Deployment")]),t._v(" "),s("p",[t._v("用于管理pod，deployment的定义文件要有")]),t._v(" "),s("ul",[s("li",[t._v("目标pod的定义")]),t._v(" "),s("li",[t._v("目标pod要运行的副本数量replicas")]),t._v(" "),s("li",[t._v("要监控的目标pod的标签")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(275),alt:""}})]),t._v(" "),s("p",[t._v("replicaSet：确保任何时间都有指定数量的pod运行，建议用deployment来管理rs")]),t._v(" "),s("p",[t._v("master通过deployment将特定副本数量应用实例调度到合适节点上运行，当节点关闭或被删除自动调度到其他节点运行实例。")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl create deployment kubernetes-nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--image")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx:1.10\n")])])]),s("h2",{attrs:{id:"pod"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pod"}},[t._v("#")]),t._v(" pod")]),t._v(" "),s("ul",[s("li",[t._v("提供服务的进程，都被包装到相应的pod中，使其成为pod中运行的一个容器。")]),t._v(" "),s("li",[t._v("每个pod都运行一个Pause的基础容器，用作共享网络和挂载卷；其他容器都以业务容器，共享pause容器的网络和挂载。")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(276),alt:""}})]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl get pods\nkubectl describe pods\n")])])]),s("h2",{attrs:{id:"service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[t._v("#")]),t._v(" service")]),t._v(" "),s("ul",[s("li",[t._v("唯一指定的名称（eg：mysql-server）")]),t._v(" "),s("li",[t._v("一个虚拟IP地址（ClusterIp地址）和端口号")]),t._v(" "),s("li",[t._v("提供远程服务能力")]),t._v(" "),s("li",[t._v("将请求转发到一组容器应用上")])]),t._v(" "),s("p",[t._v("service和pod的联系")]),t._v(" "),s("ol",[s("li",[t._v("service对应一个或者多个pod，service定义了一组pod的逻辑集")]),t._v(" "),s("li",[t._v("每个pod都贴上标签Label（eg：运行php的pod标签是name=mysql）")]),t._v(" "),s("li",[t._v("service定义标签选择器（eg：PHP service标签选择器作用与所有包含name=php的pod）")]),t._v(" "),s("li",[t._v("不是每个pod和它里面运行的容器都能被映射到一个service上，只有提供服务（对内对外都行）的那组pod才会被映射为一个服务。")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(277),alt:""}})]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl get svc\n")])])]),s("h2",{attrs:{id:"configmap"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configmap"}},[t._v("#")]),t._v(" configMap")]),t._v(" "),s("p",[t._v("说白了就是一个资源的yaml文件")]),t._v(" "),s("blockquote",[s("p",[t._v("是一种API对象，用来将非机密性的数据保存到键值对中。使用时，Pod可以将其用作环境变量、命令行参数或者存储卷中的配置文件。使用ConfigMap可以将你的配置数据和应用程序代码分开。")])]),t._v(" "),s("p",[t._v("ConfigMap允许你"),s("strong",[t._v("将配置文件与镜像文件分离")]),t._v("，以使"),s("strong",[t._v("容器化的应用程序具有可移植性")]),t._v("。")]),t._v(" "),s("h1",{attrs:{id:"k8s应用部署实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#k8s应用部署实践"}},[t._v("#")]),t._v(" k8s应用部署实践")]),t._v(" "),s("blockquote",[s("p",[t._v("k8s中所有的对象创建或删除都建"),s("strong",[t._v("议用配置文件的方式来设置")]),t._v("，避免直接用命令创建或删除")])]),t._v(" "),s("p",[t._v("mysql-deploy.yml")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# API版本")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此资源对象的类型，Deployment")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 标签")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对象名称，全局唯一")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此资源对象相关属性定义")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 副本数量")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pod选择器")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pod模板")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定新建pod的标签，必须和上面的selector匹配")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 定义容器")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5.7")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("MYSQL_ROOT_PASSWORD\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"123456"')]),t._v("\n          \n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl apply "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" mysql-deploy.yml\nkubectl get deploy\nkubectl get pods\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl delete -f mysql-deploy.yml")]),t._v("\n")])])]),s("p",[t._v("有了deployment管理创建pod之后，要想访问到pod里面的应用。还要为pod创建对应的service，来将其ip+port暴露出来以供访问")]),t._v(" "),s("p",[t._v("mysql-svc.yml")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1 "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# API版本")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此资源对象的类型，Service")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对象名称，全局唯一")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 此资源对象相关属性定义")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 定义了service的虚拟端口")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pod选择器")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kubectl create "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" mysql-svc.yml\nkubectl get svc mysql\n")])])]),s("p",[t._v("资源整合中，敬请期待！")])])}),[],!1,null,null,null);s.default=n.exports}}]);