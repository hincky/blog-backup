(window.webpackJsonp=window.webpackJsonp||[]).push([[312],{626:function(a,t,s){"use strict";s.r(t);var e=s(14),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"iptables"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#iptables"}},[a._v("#")]),a._v(" iptables")]),a._v(" "),t("p",[a._v("Linux上常用的防火墙软件")]),a._v(" "),t("h2",{attrs:{id:"补充说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#补充说明"}},[a._v("#")]),a._v(" 补充说明")]),a._v(" "),t("p",[t("strong",[a._v("iptables命令")]),a._v(" 是Linux上常用的防火墙软件，是netfilter项目的一部分。可以直接配置，也可以通过许多前端和图形界面配置。")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E"}},[a._v("补充说明")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#%E8%AF%AD%E6%B3%95"}},[a._v("语法")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E9%80%89%E9%A1%B9"}},[a._v("选项")])])])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E5%9F%BA%E6%9C%AC%E5%8F%82%E6%95%B0"}},[a._v("基本参数")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#%E5%91%BD%E4%BB%A4%E9%80%89%E9%A1%B9%E8%BE%93%E5%85%A5%E9%A1%BA%E5%BA%8F"}},[a._v("命令选项输入顺序")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"}},[a._v("工作机制")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E9%98%B2%E7%81%AB%E5%A2%99%E7%9A%84%E7%AD%96%E7%95%A5"}},[a._v("防火墙的策略")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E9%98%B2%E7%81%AB%E5%A2%99%E7%9A%84%E7%AD%96%E7%95%A5-1"}},[a._v("防火墙的策略")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E5%AE%9E%E4%BE%8B"}},[a._v("实例")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"#%E6%B8%85%E7%A9%BA%E5%BD%93%E5%89%8D%E7%9A%84%E6%89%80%E6%9C%89%E8%A7%84%E5%88%99%E5%92%8C%E8%AE%A1%E6%95%B0"}},[a._v("清空当前的所有规则和计数")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E9%85%8D%E7%BD%AE%E5%85%81%E8%AE%B8ssh%E7%AB%AF%E5%8F%A3%E8%BF%9E%E6%8E%A5"}},[a._v("配置允许ssh端口连接")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E5%85%81%E8%AE%B8%E6%9C%AC%E5%9C%B0%E5%9B%9E%E7%8E%AF%E5%9C%B0%E5%9D%80%E5%8F%AF%E4%BB%A5%E6%AD%A3%E5%B8%B8%E4%BD%BF%E7%94%A8"}},[a._v("允许本地回环地址可以正常使用")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E8%AE%BE%E7%BD%AE%E9%BB%98%E8%AE%A4%E7%9A%84%E8%A7%84%E5%88%99"}},[a._v("设置默认的规则")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E9%85%8D%E7%BD%AE%E7%99%BD%E5%90%8D%E5%8D%95"}},[a._v("配置白名单")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E5%BC%80%E5%90%AF%E7%9B%B8%E5%BA%94%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3"}},[a._v("开启相应的服务端口")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E4%BF%9D%E5%AD%98%E8%A7%84%E5%88%99%E5%88%B0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD"}},[a._v("保存规则到配置文件中")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E5%88%97%E5%87%BA%E5%B7%B2%E8%AE%BE%E7%BD%AE%E7%9A%84%E8%A7%84%E5%88%99"}},[a._v("列出已设置的规则")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E6%B8%85%E9%99%A4%E5%B7%B2%E6%9C%89%E8%A7%84%E5%88%99"}},[a._v("清除已有规则")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E5%88%A0%E9%99%A4%E5%B7%B2%E6%B7%BB%E5%8A%A0%E7%9A%84%E8%A7%84%E5%88%99"}},[a._v("删除已添加的规则")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E5%BC%80%E6%94%BE%E6%8C%87%E5%AE%9A%E7%9A%84%E7%AB%AF%E5%8F%A3"}},[a._v("开放指定的端口")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E5%B1%8F%E8%94%BDip"}},[a._v("屏蔽IP")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E6%8C%87%E5%AE%9A%E6%95%B0%E6%8D%AE%E5%8C%85%E5%87%BA%E5%8E%BB%E7%9A%84%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3"}},[a._v("指定数据包出去的网络接口")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E6%9F%A5%E7%9C%8B%E5%B7%B2%E6%B7%BB%E5%8A%A0%E7%9A%84%E8%A7%84%E5%88%99"}},[a._v("查看已添加的规则")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E5%90%AF%E5%8A%A8%E7%BD%91%E7%BB%9C%E8%BD%AC%E5%8F%91%E8%A7%84%E5%88%99"}},[a._v("启动网络转发规则")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84"}},[a._v("端口映射")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D"}},[a._v("字符串匹配")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E9%98%BB%E6%AD%A2windows%E8%A0%95%E8%99%AB%E7%9A%84%E6%94%BB%E5%87%BB"}},[a._v("阻止Windows蠕虫的攻击")])]),a._v(" "),t("li",[t("a",{attrs:{href:"#%E9%98%B2%E6%AD%A2syn%E6%B4%AA%E6%B0%B4%E6%94%BB%E5%87%BB"}},[a._v("防止SYN洪水攻击")])])])])])])]),a._v(" "),t("h3",{attrs:{id:"语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#语法"}},[a._v("#")]),a._v(" 语法")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("选项"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("参数"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("h3",{attrs:{id:"选项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#选项"}},[a._v("#")]),a._v(" 选项")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("-t, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--table")]),a._v(" table 对指定的表 table 进行操作， table 必须是 raw， nat，filter，mangle 中的一个。如果不指定此选项，默认的是 filter 表。\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 通用匹配：源地址目标地址的匹配")]),a._v("\n-p：指定要匹配的数据包协议类型；\n-s, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--source")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" address"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("/mask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" ：把指定的一个／一组地址作为源地址，按此规则进行过滤。当后面没有 mask 时，address 是一个地址，比如：192.168.1.1；当 mask 指定时，可以表示一组范围内的地址，比如：192.168.1.0/255.255.255.0。\n-d, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--destination")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" address"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("/mask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" ：地址格式同上，但这里是指定地址为目的地址，按此进行过滤。\n-i, --in-interface "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("网络接口name"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ：指定数据包的来自来自网络接口，比如最常见的 eth0 。注意：它只对 INPUT，FORWARD，PREROUTING 这三个链起作用。如果没有指定此选项， 说明可以来自任何一个网络接口。同前面类似，"),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"!"')]),a._v(" 表示取反。\n-o, --out-interface "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("网络接口name"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ：指定数据包出去的网络接口。只对 OUTPUT，FORWARD，POSTROUTING 三个链起作用。\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看管理命令")]),a._v("\n-L, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--list")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("chain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" 列出链 chain 上面的所有规则，如果没有指定链，列出表上所有链的所有规则。\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 规则管理命令")]),a._v("\n-A, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--append")]),a._v(" chain rule-specification 在指定链 chain 的末尾插入指定的规则，也就是说，这条规则会被放到最后，最后才会被执行。规则是由后面的匹配来指定。\n-I, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--insert")]),a._v(" chain "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("rulenum"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" rule-specification 在链 chain 中的指定位置插入一条或多条规则。如果指定的规则号是1，则在链的头部插入。这也是默认的情况，如果没有指定规则号。\n-D, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--delete")]),a._v(" chain rule-specification -D, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--delete")]),a._v(" chain rulenum 在指定的链 chain 中删除一个或多个指定规则。\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-R")]),a._v(" num：Replays替换/修改第几条规则\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 链管理命令（这都是立即生效的）")]),a._v("\n-P, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--policy")]),a._v(" chain target ：为指定的链 chain 设置策略 target。注意，只有内置的链才允许有策略，用户自定义的是不允许的。\n-F, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--flush")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("chain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" 清空指定链 chain 上面的所有规则。如果没有指定链，清空该表上所有链的所有规则。\n-N, --new-chain chain 用指定的名字创建一个新的链。\n-X, --delete-chain "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("chain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" ：删除指定的链，这个链必须没有被其它任何规则引用，而且这条上必须没有任何规则。如果没有指定链名，则会删除该表中所有非内置的链。\n-E, --rename-chain old-chain new-chain ：用指定的新名字去重命名指定的链。这并不会对链内部造成任何影响。\n-Z, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--zero")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("chain"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" ：把指定链，或者表中的所有链上的所有计数器清零。\n\n-j, "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--jump")]),a._v(" target "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("指定目标"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" ：即满足某条件时该执行什么样的动作。target 可以是内置的目标，比如 ACCEPT，也可以是用户自定义的链。\n-h：显示帮助信息；\n")])])]),t("h2",{attrs:{id:"基本参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本参数"}},[a._v("#")]),a._v(" 基本参数")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("参数")]),a._v(" "),t("th",[a._v("作用")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("-P")]),a._v(" "),t("td",[a._v("设置默认策略:iptables -P INPUT (DROP")])]),a._v(" "),t("tr",[t("td",[a._v("-F")]),a._v(" "),t("td",[a._v("清空规则链")])]),a._v(" "),t("tr",[t("td",[a._v("-L")]),a._v(" "),t("td",[a._v("查看规则链")])]),a._v(" "),t("tr",[t("td",[a._v("-A")]),a._v(" "),t("td",[a._v("在规则链的末尾加入新规则")])]),a._v(" "),t("tr",[t("td",[a._v("-I")]),a._v(" "),t("td",[a._v("num  在规则链的头部加入新规则")])]),a._v(" "),t("tr",[t("td",[a._v("-D")]),a._v(" "),t("td",[a._v("num  删除某一条规则")])]),a._v(" "),t("tr",[t("td",[a._v("-s")]),a._v(" "),t("td",[a._v('匹配来源地址IP/MASK，加叹号"!"表示除这个IP外。')])]),a._v(" "),t("tr",[t("td",[a._v("-d")]),a._v(" "),t("td",[a._v("匹配目标地址")])]),a._v(" "),t("tr",[t("td",[a._v("-i")]),a._v(" "),t("td",[a._v("网卡名称 匹配从这块网卡流入的数据")])]),a._v(" "),t("tr",[t("td",[a._v("-o")]),a._v(" "),t("td",[a._v("网卡名称 匹配从这块网卡流出的数据")])]),a._v(" "),t("tr",[t("td",[a._v("-p")]),a._v(" "),t("td",[a._v("匹配协议,如tcp,udp,icmp")])]),a._v(" "),t("tr",[t("td",[a._v("--dport num")]),a._v(" "),t("td",[a._v("匹配目标端口号")])]),a._v(" "),t("tr",[t("td",[a._v("--sport num")]),a._v(" "),t("td",[a._v("匹配来源端口号")])])])]),a._v(" "),t("h4",{attrs:{id:"命令选项输入顺序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令选项输入顺序"}},[a._v("#")]),a._v(" 命令选项输入顺序")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" 表名 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("-A/I/D/R"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" 规则链名 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("规则号"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("-i/o 网卡名"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" 协议名 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("-s 源IP/源子网"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--sport")]),a._v(" 源端口 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("-d 目标IP/目标子网"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" 目标端口 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" 动作\n")])])]),t("h4",{attrs:{id:"工作机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工作机制"}},[a._v("#")]),a._v(" 工作机制")]),a._v(" "),t("p",[a._v("规则链名包括(也被称为五个钩子函数（hook functions）)：")]),a._v(" "),t("ul",[t("li",[t("strong",[a._v("INPUT链")]),a._v(" ：处理输入数据包。")]),a._v(" "),t("li",[t("strong",[a._v("OUTPUT链")]),a._v(" ：处理输出数据包。")]),a._v(" "),t("li",[t("strong",[a._v("FORWARD链")]),a._v(" ：处理转发数据包。")]),a._v(" "),t("li",[t("strong",[a._v("PREROUTING链")]),a._v(" ：用于目标地址转换（DNAT）。")]),a._v(" "),t("li",[t("strong",[a._v("POSTOUTING链")]),a._v(" ：用于源地址转换（SNAT）。")])]),a._v(" "),t("h4",{attrs:{id:"防火墙的策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#防火墙的策略"}},[a._v("#")]),a._v(" 防火墙的策略")]),a._v(" "),t("p",[a._v("防火墙策略一般分为两种，一种叫"),t("code",[a._v("通")]),a._v("策略，一种叫"),t("code",[a._v("堵")]),a._v("策略，通策略，默认门是关着的，必须要定义谁能进。堵策略则是，大门是洞开的，但是你必须有身份认证，否则不能进。所以我们要定义，让进来的进来，让出去的出去，"),t("code",[a._v("所以通，是要全通，而堵，则是要选择")]),a._v("。当我们定义的策略的时候，要分别定义多条功能，其中：定义数据包中允许或者不允许的策略，filter过滤的功能，而定义地址转换的功能的则是nat选项。为了让这些功能交替工作，我们制定出了“表”这个定义，来定义、区分各种不同的工作功能和处理方式。")]),a._v(" "),t("p",[a._v("我们现在用的比较多个功能有3个：")]),a._v(" "),t("ol",[t("li",[a._v("filter 定义允许或者不允许的，只能做在3个链上：INPUT ，FORWARD ，OUTPUT")]),a._v(" "),t("li",[a._v("nat 定义地址转换的，也只能做在3个链上：PREROUTING ，OUTPUT ，POSTROUTING")]),a._v(" "),t("li",[a._v("mangle功能:修改报文原数据，是5个链都可以做：PREROUTING，INPUT，FORWARD，OUTPUT，POSTROUTING")])]),a._v(" "),t("p",[a._v("我们修改报文原数据就是来修改TTL的。能够实现将数据包的元数据拆开，在里面做标记/修改内容的。而防火墙标记，其实就是靠mangle来实现的。")]),a._v(" "),t("p",[a._v("小扩展:")]),a._v(" "),t("ul",[t("li",[a._v("对于filter来讲一般只能做在3个链上：INPUT ，FORWARD ，OUTPUT")]),a._v(" "),t("li",[a._v("对于nat来讲一般也只能做在3个链上：PREROUTING ，OUTPUT ，POSTROUTING")]),a._v(" "),t("li",[a._v("而mangle则是5个链都可以做：PREROUTING，INPUT，FORWARD，OUTPUT，POSTROUTING")])]),a._v(" "),t("p",[a._v("iptables/netfilter（这款软件）是工作在用户空间的，它可以让规则进行生效的，本身不是一种服务，而且规则是立即生效的。而我们iptables现在被做成了一个服务，可以进行启动，停止的。启动，则将规则直接生效，停止，则将规则撤销。")]),a._v(" "),t("p",[a._v("iptables还支持自己定义链。但是自己定义的链，必须是跟某种特定的链关联起来的。在一个关卡设定，指定当有数据的时候专门去找某个特定的链来处理，当那个链处理完之后，再返回。接着在特定的链中继续检查。")]),a._v(" "),t("p",[a._v("注意：规则的次序非常关键，"),t("code",[a._v("谁的规则越严格，应该放的越靠前")]),a._v("，而检查规则的时候，是按照从上往下的方式进行检查的。")]),a._v(" "),t("p",[a._v("表名包括：")]),a._v(" "),t("ul",[t("li",[t("strong",[a._v("raw")]),a._v(" ：高级功能，如：网址过滤。")]),a._v(" "),t("li",[t("strong",[a._v("mangle")]),a._v(" ：数据包修改（QOS），用于实现服务质量。")]),a._v(" "),t("li",[t("strong",[a._v("nat")]),a._v(" ：地址转换，用于网关路由器。")]),a._v(" "),t("li",[t("strong",[a._v("filter")]),a._v(" ：包过滤，用于防火墙规则。")])]),a._v(" "),t("p",[a._v("动作包括：")]),a._v(" "),t("ul",[t("li",[t("strong",[a._v("ACCEPT")]),a._v(" ：接收数据包。")]),a._v(" "),t("li",[t("strong",[a._v("DROP")]),a._v(" ：丢弃数据包。")]),a._v(" "),t("li",[t("strong",[a._v("REDIRECT")]),a._v(" ：重定向、映射、透明代理。")]),a._v(" "),t("li",[t("strong",[a._v("SNAT")]),a._v(" ：源地址转换。")]),a._v(" "),t("li",[t("strong",[a._v("DNAT")]),a._v(" ：目标地址转换。")]),a._v(" "),t("li",[t("strong",[a._v("MASQUERADE")]),a._v(" ：IP伪装（NAT），用于ADSL。")]),a._v(" "),t("li",[t("strong",[a._v("LOG")]),a._v(" ：日志记录。")]),a._v(" "),t("li",[t("strong",[a._v("SEMARK")]),a._v(" : 添加SEMARK标记以供网域内强制访问控制（MAC）")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("                             ┏╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍┓\n ┌───────────────┐           ┃    Network    ┃\n │ table: filter │           ┗━━━━━━━┳━━━━━━━┛\n │ chain: INPUT  │◀────┐             │\n └───────┬───────┘     │             ▼\n         │             │   ┌───────────────────┐\n  ┌      ▼      ┐      │   │ table: nat        │\n  │local process│      │   │ chain: PREROUTING │\n  └             ┘      │   └─────────┬─────────┘\n         │             │             │\n         ▼             │             ▼              ┌─────────────────┐\n┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅    │     ┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅      │table: nat       │\n Routing decision      └───── outing decision ─────▶│chain: PREROUTING│\n┅┅┅┅┅┅┅┅┅┳┅┅┅┅┅┅┅┅┅          ┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅      └────────┬────────┘\n         │                                                   │\n         ▼                                                   │\n ┌───────────────┐                                           │\n │ table: nat    │           ┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅┅               │\n │ chain: OUTPUT │    ┌─────▶ outing decision ◀──────────────┘\n └───────┬───────┘    │      ┅┅┅┅┅┅┅┅┳┅┅┅┅┅┅┅┅\n         │            │              │\n         ▼            │              ▼\n ┌───────────────┐    │   ┌────────────────────┐\n │ table: filter │    │   │ chain: POSTROUTING │\n │ chain: OUTPUT ├────┘   └──────────┬─────────┘\n └───────────────┘                   │\n                                     ▼\n                             ┏╍╍╍╍╍╍╍╍╍╍╍╍╍╍╍┓\n                             ┃    Network    ┃\n                             ┗━━━━━━━━━━━━━━━┛\n")])])]),t("h3",{attrs:{id:"实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#实例"}},[a._v("#")]),a._v(" 实例")]),a._v(" "),t("h4",{attrs:{id:"清空当前的所有规则和计数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#清空当前的所有规则和计数"}},[a._v("#")]),a._v(" 清空当前的所有规则和计数")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-F")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 清空所有的防火墙规则")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除用户自定义的空链")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Z")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 清空计数")]),a._v("\n")])])]),t("h4",{attrs:{id:"配置允许ssh端口连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置允许ssh端口连接"}},[a._v("#")]),a._v(" 配置允许ssh端口连接")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.0/24 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 22为你的ssh端口， -s 192.168.1.0/24表示允许这个网段的机器来连接，其它网段的ip地址是登陆不了你的机器的。 -j ACCEPT表示接受这样的请求")]),a._v("\n")])])]),t("h4",{attrs:{id:"允许本地回环地址可以正常使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#允许本地回环地址可以正常使用"}},[a._v("#")]),a._v(" 允许本地回环地址可以正常使用")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" lo "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#本地圆环地址就是那个127.0.0.1，是本机上使用的,它进与出都设置为允许")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" OUTPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" lo "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n")])])]),t("h4",{attrs:{id:"设置默认的规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置默认的规则"}},[a._v("#")]),a._v(" 设置默认的规则")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" INPUT DROP "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置默认的不让进")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" FORWARD DROP "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 默认的不允许转发")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-P")]),a._v(" OUTPUT ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 默认的可以出去")]),a._v("\n")])])]),t("h4",{attrs:{id:"配置白名单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置白名单"}},[a._v("#")]),a._v(" 配置白名单")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" all "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.0/24 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许机房内网机器可以访问")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" all "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".140.0/24 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许机房内网机器可以访问")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("183.121")]),a._v(".3.7 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3380")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许183.121.3.7访问本机的3380端口")]),a._v("\n")])])]),t("h4",{attrs:{id:"开启相应的服务端口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启相应的服务端口"}},[a._v("#")]),a._v(" 开启相应的服务端口")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 开启80端口，因为web对外都是这个端口")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" icmp --icmp-type "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许被ping")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" state "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--state")]),a._v(" ESTABLISHED,RELATED "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 已经建立的连接得让它进来")]),a._v("\n")])])]),t("h4",{attrs:{id:"保存规则到配置文件中"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#保存规则到配置文件中"}},[a._v("#")]),a._v(" 保存规则到配置文件中")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cp")]),a._v(" /etc/sysconfig/iptables /etc/sysconfig/iptables.bak "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 任何改动之前先备份，请保持这一优秀的习惯")]),a._v("\niptables-save "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /etc/sysconfig/iptables\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /etc/sysconfig/iptables\n")])])]),t("h4",{attrs:{id:"列出已设置的规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#列出已设置的规则"}},[a._v("#")]),a._v(" 列出已设置的规则")]),a._v(" "),t("blockquote",[t("p",[a._v("iptables -L [-t 表名] [链名]")])]),a._v(" "),t("ul",[t("li",[a._v("四个表名 "),t("code",[a._v("raw")]),a._v("，"),t("code",[a._v("nat")]),a._v("，"),t("code",[a._v("filter")]),a._v("，"),t("code",[a._v("mangle")])]),a._v(" "),t("li",[a._v("五个规则链名 "),t("code",[a._v("INPUT")]),a._v("、"),t("code",[a._v("OUTPUT")]),a._v("、"),t("code",[a._v("FORWARD")]),a._v("、"),t("code",[a._v("PREROUTING")]),a._v("、"),t("code",[a._v("POSTROUTING")])]),a._v(" "),t("li",[a._v("filter表包含"),t("code",[a._v("INPUT")]),a._v("、"),t("code",[a._v("OUTPUT")]),a._v("、"),t("code",[a._v("FORWARD")]),a._v("三个规则链")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 列出 nat 上面的所有规则")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#            ^ -t 参数指定，必须是 raw， nat，filter，mangle 中的一个")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat  --line-numbers  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 规则带编号")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" INPUT\n\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-nv")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看，这个列表看起来更详细")]),a._v("\n")])])]),t("h4",{attrs:{id:"清除已有规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#清除已有规则"}},[a._v("#")]),a._v(" 清除已有规则")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-F")]),a._v(" INPUT  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 清空指定链 INPUT 上面的所有规则")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" INPUT  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 删除指定的链，这个链必须没有被其它任何规则引用，而且这条上必须没有任何规则。")]),a._v("\n                   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 如果没有指定链名，则会删除该表中所有非内置的链。")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Z")]),a._v(" INPUT  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 把指定链，或者表中的所有链上的所有计数器清零。")]),a._v("\n")])])]),t("h4",{attrs:{id:"删除已添加的规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除已添加的规则"}},[a._v("#")]),a._v(" 删除已添加的规则")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 添加一条规则")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.5 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DROP\n")])])]),t("p",[a._v("将所有iptables以序号标记显示，执行：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" --line-numbers\n")])])]),t("p",[a._v("比如要删除INPUT里序号为8的规则，执行：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-D")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v("\n")])])]),t("h4",{attrs:{id:"开放指定的端口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开放指定的端口"}},[a._v("#")]),a._v(" 开放指定的端口")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("127.0")]),a._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT               "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#允许本地回环接口(即运行本机访问本机)")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" state "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--state")]),a._v(" ESTABLISHED,RELATED "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#允许已建立的或相关连的通行")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" OUTPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT         "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#允许所有本机向外的访问")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#允许访问22端口")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#允许访问80端口")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("21")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#允许ftp服务的21端口")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#允许FTP服务的20端口")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" reject       "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#禁止其他未允许的规则访问")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" FORWARD "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REJECT     "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#禁止其他未允许的规则访问")]),a._v("\n")])])]),t("h4",{attrs:{id:"屏蔽ip"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#屏蔽ip"}},[a._v("#")]),a._v(" 屏蔽IP")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".0.8 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DROP  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 屏蔽恶意主机（比如，192.168.0.8")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("123.45")]),a._v(".6.7 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DROP       "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#屏蔽单个IP的命令")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("123.0")]),a._v(".0.0/8 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DROP      "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#封整个段即从123.0.0.1到123.255.255.254的命令")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("124.45")]),a._v(".0.0/16 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DROP    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#封IP段即从123.45.0.1到123.45.255.254的命令")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("123.45")]),a._v(".6.0/24 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DROP    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#封IP段即从123.45.6.1到123.45.6.254的命令是")]),a._v("\n")])])]),t("h4",{attrs:{id:"指定数据包出去的网络接口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#指定数据包出去的网络接口"}},[a._v("#")]),a._v(" 指定数据包出去的网络接口")]),a._v(" "),t("p",[a._v("只对 OUTPUT，FORWARD，POSTROUTING 三个链起作用。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" FORWARD "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" eth0\n")])])]),t("h4",{attrs:{id:"查看已添加的规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看已添加的规则"}},[a._v("#")]),a._v(" 查看已添加的规则")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v("\nChain INPUT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("policy DROP "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("48106")]),a._v(" packets, 2690K bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n pkts bytes target     prot opt "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v("     out     "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v("               destination\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5075")]),a._v("  589K ACCEPT     all  --  lo     *       "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/0            "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/0\n 191K   90M ACCEPT     tcp  --  *      *       "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/0            "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/0           tcp dpt:22\n1499K  133M ACCEPT     tcp  --  *      *       "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/0            "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/0           tcp dpt:80\n4364K 6351M ACCEPT     all  --  *      *       "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/0            "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/0           state RELATED,ESTABLISHED\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("6256")]),a._v("  327K ACCEPT     icmp --  *      *       "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/0            "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/0\n\nChain FORWARD "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("policy ACCEPT "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" packets, "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n pkts bytes target     prot opt "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v("     out     "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v("               destination\n\nChain OUTPUT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("policy ACCEPT 3382K packets, 1819M bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n pkts bytes target     prot opt "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("in")]),a._v("     out     "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v("               destination\n "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5075")]),a._v("  589K ACCEPT     all  --  *      lo      "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/0            "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/0\n")])])]),t("h4",{attrs:{id:"启动网络转发规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动网络转发规则"}},[a._v("#")]),a._v(" 启动网络转发规则")]),a._v(" "),t("p",[a._v("公网"),t("code",[a._v("210.14.67.7")]),a._v("让内网"),t("code",[a._v("192.168.188.0/24")]),a._v("上网")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" POSTROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".188.0/24 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" SNAT --to-source "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("210.14")]),a._v(".67.127\n")])])]),t("h4",{attrs:{id:"端口映射"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#端口映射"}},[a._v("#")]),a._v(" 端口映射")]),a._v(" "),t("p",[a._v("本机的 2222 端口映射到内网 虚拟机的22 端口")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" PREROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("210.14")]),a._v(".67.127 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2222")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DNAT --to-dest "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".188.115:22\n")])])]),t("h4",{attrs:{id:"字符串匹配"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#字符串匹配"}},[a._v("#")]),a._v(" 字符串匹配")]),a._v(" "),t("p",[a._v("比如，我们要过滤所有TCP连接中的字符串"),t("code",[a._v("test")]),a._v("，一旦出现它我们就终止这个连接，我们可以这么做：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" string "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--algo")]),a._v(" kmp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--string")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"test"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REJECT --reject-with tcp-reset\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Chain INPUT (policy ACCEPT)")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# target     prot opt source               destination")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v('# REJECT     tcp  --  anywhere             anywhere            STRING match "test" ALGO name kmp TO 65535 reject-with tcp-reset')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Chain FORWARD (policy ACCEPT)")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# target     prot opt source               destination")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Chain OUTPUT (policy ACCEPT)")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# target     prot opt source               destination")]),a._v("\n")])])]),t("h4",{attrs:{id:"阻止windows蠕虫的攻击"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#阻止windows蠕虫的攻击"}},[a._v("#")]),a._v(" 阻止Windows蠕虫的攻击")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DROP "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v(".0.0/0 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" string "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--algo")]),a._v(" kmp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--string")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"cmd.exe"')]),a._v("\n")])])]),t("h4",{attrs:{id:"防止syn洪水攻击"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#防止syn洪水攻击"}},[a._v("#")]),a._v(" 防止SYN洪水攻击")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--syn")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" limit "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--limit")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("/second "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n")])])]),t("h4",{attrs:{id:"添加secmark记录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加secmark记录"}},[a._v("#")]),a._v(" 添加SECMARK记录")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" mangle "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--src")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("192.168")]),a._v(".1.2 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" SECMARK "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--selctx")]),a._v(" system_u:object_r:myauth_packet_t\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 向从 192.168.1.2:443 以TCP方式发出到本机的包添加MAC安全上下文 system_u:object_r:myauth_packet_t")]),a._v("\n")])])]),t("h2",{attrs:{id:"更多实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更多实例"}},[a._v("#")]),a._v(" 更多实例")]),a._v(" "),t("blockquote",[t("p",[a._v("用iptables搭建一套强大的安全防护盾 http://www.imooc.com/learn/389")])]),a._v(" "),t("p",[a._v("iptables: linux 下应用层防火墙工具")]),a._v(" "),t("p",[a._v("iptables 5链: 对应 Hook point\nnetfilter: linux 操作系统核心层内部的一个数据包处理模块\nHook point: 数据包在 netfilter 中的挂载点; "),t("code",[a._v("PRE_ROUTING / INPUT / OUTPUT / FORWARD / POST_ROUTING")])]),a._v(" "),t("p",[a._v("iptables & netfilter\n"),t("img",{attrs:{src:"http://7xq89b.com1.z0.glb.clouddn.com/netfilter&iptables.jpg",alt:""}})]),a._v(" "),t("p",[a._v("iptables 4表5链\n"),t("img",{attrs:{src:"http://7xq89b.com1.z0.glb.clouddn.com/iptables-data-stream.jpg",alt:""}})]),a._v(" "),t("p",[a._v("iptables rules\n"),t("img",{attrs:{src:"http://7xq89b.com1.z0.glb.clouddn.com/iptables-rules.jpg",alt:""}})]),a._v(" "),t("ul",[t("li",[a._v("4表")])]),a._v(" "),t("p",[t("strong",[a._v("filter")]),a._v(": 访问控制 / 规则匹配\n"),t("strong",[a._v("nat")]),a._v(": 地址转发\nmangle / raw")]),a._v(" "),t("ul",[t("li",[a._v("规则")])]),a._v(" "),t("p",[a._v("数据访问控制: ACCEPT / DROP / REJECT\n数据包改写(nat -> 地址转换): snat / dnat\n信息记录: log")]),a._v(" "),t("h2",{attrs:{id:"使用场景实例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用场景实例"}},[a._v("#")]),a._v(" 使用场景实例")]),a._v(" "),t("ul",[t("li",[a._v("场景一")])]),a._v(" "),t("p",[a._v("开放 tcp 10-22/80 端口\n开放 icmp\n其他未被允许的端口禁止访问")]),a._v(" "),t("p",[a._v("存在的问题: 本机无法访问本机; 本机无法访问其他主机")]),a._v(" "),t("ul",[t("li",[a._v("场景二")])]),a._v(" "),t("p",[a._v("ftp: 默认被动模式(服务器产生随机端口告诉客户端, 客户端主动连接这个端口拉取数据)\nvsftpd: 使 ftp 支持主动模式(客户端产生随机端口通知服务器, 服务器主动连接这个端口发送数据)")]),a._v(" "),t("ul",[t("li",[a._v("场景三")])]),a._v(" "),t("p",[a._v("允许外网访问:\nweb\nhttp -> 80/tcp; https -> 443/tcp\nmail\nsmtp -> 25/tcp; smtps -> 465/tcp\npop3 -> 110/tcp; pop3s -> 995/tcp\nimap -> 143/tcp")]),a._v(" "),t("p",[a._v("内部使用:\nfile\nnfs -> 123/udp\nsamba -> 137/138/139/445/tcp\nftp -> 20/21/tcp\nremote\nssh -> 22/tcp\nsql\nmysql -> 3306/tcp\noracle -> 1521/tcp")]),a._v(" "),t("ul",[t("li",[a._v("场景四")])]),a._v(" "),t("p",[a._v("nat 转发")]),a._v(" "),t("ul",[t("li",[a._v("场景五")])]),a._v(" "),t("p",[a._v("防CC攻击")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("iptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-F")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-D")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# list flush append delete")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 场景一")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许 tcp 80 端口")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(":22 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许 tcp 10-22 端口")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" icmp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许 icmp")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REJECT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 添加一条规则, 不允许所有")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 优化场景一")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" lo "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许本机访问")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" state "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--state")]),a._v(" ESTABLISHED,RELATED "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许访问外网")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.10")]),a._v(".188.233 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 只允许固定ip访问80")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 场景二")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/vsftpd/vsftpd.conf "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 使用 vsftpd 开启 ftp 主动模式")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("port_enable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("yes\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("connect_from_port_20")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("YES\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("21")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/vsftpd/vsftpd.conf "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 建议使用 ftp 被动模式")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("pasv_min_port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("50000")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("pasv_max_port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("60000")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("21")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("50000")]),a._v(":60000 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 还可以使用 iptables 模块追踪来自动开发对应的端口")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 场景三")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" lo "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许本机访问")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" state "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--state")]),a._v(" ESTABLISHED,RELATED "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许访问外网")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.10")]),a._v(".155.0/24 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许内网访问")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" multiport "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dports")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80,1723")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 允许端口, 80 -> http, 1723 -> vpn")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REJECT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 添加一条规则, 不允许所有")]),a._v("\n\niptables-save "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 保存设置到配置文件")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 场景四")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 查看 nat 配置")]),a._v("\n\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" POST_ROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.10")]),a._v(".177.0/24 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" SNAT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--to")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.10")]),a._v(".188.232 "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# SNAT")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("vi")]),a._v(" /etc/sysconfig/network "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 配置网关")]),a._v("\n\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-t")]),a._v(" nat "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-A")]),a._v(" POST_ROUTING "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.10")]),a._v(".188.232 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" DNAT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--to")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.10")]),a._v(".177.232:80 "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# DNAT")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#场景五")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" tcp "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--syn")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--dport")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" connlimit --connlimit-above "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("100")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" REJECT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 限制并发连接访问数")]),a._v("\niptables "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" INPUT "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),a._v(" limit "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--limit")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),a._v("/hour --limit-burst "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-j")]),a._v(" ACCEPT "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# limit模块; --limit-burst 默认为5")]),a._v("\n")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);