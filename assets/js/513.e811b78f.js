(window.webpackJsonp=window.webpackJsonp||[]).push([[513],{825:function(t,s,a){"use strict";a.r(s);var e=a(14),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"semanage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#semanage"}},[t._v("#")]),t._v(" semanage")]),t._v(" "),s("p",[t._v("默认目录的安全上下文查询与修改")]),t._v(" "),s("h2",{attrs:{id:"补充说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#补充说明"}},[t._v("#")]),t._v(" 补充说明")]),t._v(" "),s("p",[s("strong",[t._v("semanage命令")]),t._v(" 是用来查询与修改SELinux默认目录的安全上下文。SELinux的策略与规则管理相关命令：seinfo命令、sesearch命令、getsebool命令、setsebool命令、semanage命令。")]),t._v(" "),s("h3",{attrs:{id:"语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#语法"}},[t._v("#")]),t._v(" 语法")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("semanage "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("login"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("user"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("interface"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("fcontext"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("translation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v("\nsemanage fcontext -"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("d"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("-frst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" file_spec\n")])])]),s("h3",{attrs:{id:"选项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#选项"}},[t._v("#")]),t._v(" 选项")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("-l：查询。\nfcontext：主要用在安全上下文方面。\n-a：增加，你可以增加一些目录的默认安全上下文类型设置。\n-m：修改。\n-d：删除。\n")])])]),s("h3",{attrs:{id:"实例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实例"}},[t._v("#")]),t._v(" 实例")]),t._v(" "),s("p",[t._v("查询一下"),s("code",[t._v("/var/www/html")]),t._v("的默认安全性本文的设置：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("semanage fcontext "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v("\nSELinux fcontext    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("type")]),t._v("          Context\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("前面省略"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n/var/www"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/.*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("?      all files     system_u:object_r:httpd_sys_content_t:s0\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("後面省略"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("\n")])])]),s("p",[t._v("如上面例子所示，我们可以查询的到每个目录的安全性本文！而目录的设定可以使用正则表达式去指定一个范围。那么如果我们想要增加某些自定义目录的安全性本文呢？举例来说，我想要色设置"),s("code",[t._v("/srv/samba")]),t._v("成为 "),s("code",[t._v("public_content_t")]),t._v("的类型时，应该如何设置呢？")]),t._v(" "),s("p",[t._v("用semanage命令设置"),s("code",[t._v("/srv/samba")]),t._v("目录的默认安全性本文为"),s("code",[t._v("public_content_t")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" /srv/samba\nll "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Zd")]),t._v(" /srv/samba\ndrwxr-xr-x  root root root:object_r:var_t    /srv/samba\n")])])]),s("p",[t._v("如上所示，默认的情况应该是"),s("code",[t._v("var_t")]),t._v("这个咚咚的！")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("semanage fcontext "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/srv'")]),t._v("\n/srv/.*                     all files   system_u:object_r:var_t:s0\n/srv/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("^/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("*/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("?ftp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/.*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("?     all files   system_u:object_r:public_content_t:s0\n/srv/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("^/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("*/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("?www"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/.*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("?     all files   system_u:object_r:httpd_sys_content_t:s0\n/srv/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("^/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("*/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("?rsync"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/.*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("?   all files   system_u:object_r:public_content_t:s0\n/srv/gallery2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/.*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("?         all files   system_u:object_r:httpd_sys_content_t:s0\n/srv                        directory   system_u:object_r:var_t:s0   //看这里！\n")])])]),s("p",[t._v("上面则是默认的"),s("code",[t._v("/srv")]),t._v("底下的安全性本文资料，不过，并没有指定到"),s("code",[t._v("/srv/samba")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("semanage fcontext "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" public_content_t "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/srv/samba(/.*)?"')]),t._v("\nsemanage fcontext "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/srv/samba'")]),t._v("\n/srv/samba"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/.*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("?            all files   system_u:object_r:public_content_t:s0\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" /etc/selinux/targeted/contexts/files/file_contexts.local\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# This file is auto-generated by libsemanage")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Please use the semanage command to make changes")]),t._v("\n/srv/samba"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("/.*"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("?    system_u:object_r:public_content_t:s0  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#写入这个档案")]),t._v("\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("restorecon "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Rv")]),t._v(" /srv/samba* "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#尝试恢复默认值")]),t._v("\nll "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-Zd")]),t._v(" /srv/samba\ndrwxr-xr-x  root root system_u:object_r:public_content_t /srv/samba/  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#有默认值，以后用restorecon命令来修改比较简单！")]),t._v("\n")])])]),s("p",[t._v("semanage命令的功能很多，这里主要用到的仅有fcontext这个选项的用法而已。如上所示，你可以使用semanage来查询所有的目录默认值，也能够使用它来增加默认值的设置！")])])}),[],!1,null,null,null);s.default=n.exports}}]);