(window.webpackJsonp=window.webpackJsonp||[]).push([[438],{751:function(a,t,s){"use strict";s.r(t);var e=s(14),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"pfctl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#pfctl"}},[a._v("#")]),a._v(" pfctl")]),a._v(" "),t("p",[a._v("PF防火墙的配置命令")]),a._v(" "),t("h2",{attrs:{id:"补充说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#补充说明"}},[a._v("#")]),a._v(" 补充说明")]),a._v(" "),t("p",[t("strong",[a._v("pfctl命令")]),a._v(" 是PF防火墙的配置命令，PF防火墙( 全称：Packet Filter )是UNIX LIKE系统上进行TCP/ip流量过滤和网络地址转换的软件系统。PF同样也能提供TCP/IP流量的整形和控制，并且提供带宽控制和数据包优先集控制。PF最早是由Daniel Hartmeier开发的，现在的开发和维护由Daniel和openBSD小组的其他成员负责。")]),a._v(" "),t("p",[a._v("PF防火墙的功能很多，本站只列举一些基本配置。")]),a._v(" "),t("h3",{attrs:{id:"激活"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#激活"}},[a._v("#")]),a._v(" 激活")]),a._v(" "),t("p",[a._v("要激活pf并且使它在启动时调用配置文件，编辑"),t("code",[a._v("/etc/rc.conf")]),a._v("文件，修改配置pf的一行：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("pf")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("yes\n")])])]),t("p",[a._v("重启操作系统让配置生效。")]),a._v(" "),t("p",[a._v("也可以通过pfctl程序启动和停止pf：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("pfctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v("\npfctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v("\n")])])]),t("p",[a._v("注意这仅仅是启动和关闭PF，实际它不会载入规则集，规则集要么在系统启动时载入，要在PF启动后通过命令单独载入。")]),a._v(" "),t("h3",{attrs:{id:"配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[a._v("#")]),a._v(" 配置")]),a._v(" "),t("p",[a._v("系统引导到在rc脚本文件运行PF时PF从"),t("code",[a._v("/etc/pf.conf")]),a._v("文件载入配置规则。注意当"),t("code",[a._v("/etc/pf.conf")]),a._v("文件是默认配置文件，在系统调用rc脚本文件时，它仅仅是作为文本文件由pfctl装入并解释和插入pf的。对于一些应用来说，其他的规则集可以在系统引导后由其他文件载入。对于一些设计的非常好的unix程序，PF提供了足够的灵活性。")]),a._v(" "),t("p",[t("strong",[a._v("pf.conf文件有7个部分：")])]),a._v(" "),t("ol",[t("li",[a._v("宏：用户定义的变量，包括IP地址，接口名称等等。")]),a._v(" "),t("li",[a._v("表：一种用来保存IP地址列表的结构。")]),a._v(" "),t("li",[a._v("选项：控制PF如何工作的变量。")]),a._v(" "),t("li",[a._v("整形：重新处理数据包，进行正常化和碎片整理。")]),a._v(" "),t("li",[a._v("排队：提供带宽控制和数据包优先级控制。")]),a._v(" "),t("li",[a._v("转换：控制网络地址转换和数据包重定向。")]),a._v(" "),t("li",[a._v("过滤规则：在数据包通过接口时允许进行选择性的过滤和阻止。")])]),a._v(" "),t("p",[a._v("除去宏和表，其他的段在配置文件中也应该按照这个顺序出现，尽管对于一些特定的应用并不是所有的段都是必须的。")]),a._v(" "),t("p",[a._v("空行会被忽略，以#开头的行被认为是注释。")]),a._v(" "),t("h3",{attrs:{id:"控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#控制"}},[a._v("#")]),a._v(" 控制")]),a._v(" "),t("p",[a._v("引导之后，PF可以通过pfctl程序进行操作，以下是一些例子：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("pfctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" /etc/pf.conf  "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 载入 pf.conf 文件")]),a._v("\npfctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-nf")]),a._v(" /etc/pf.conf "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 解析文件，但不载入")]),a._v("\npfctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Nf")]),a._v(" /etc/pf.conf "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 只载入文件中的NAT规则")]),a._v("\npfctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Rf")]),a._v(" /etc/pf.conf "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 只载入文件中的过滤规则")]),a._v("\npfctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-sn")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 显示当前的NAT规则")]),a._v("\npfctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-sr")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 显示当前的过滤规则")]),a._v("\npfctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-ss")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 显示当前的状态表")]),a._v("\npfctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-si")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 显示过滤状态和计数")]),a._v("\npfctl "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-sa")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 显示任何可显示的")]),a._v("\n")])])]),t("p",[a._v("完整的命令列表，请参阅pfctl的man手册页。")])])}),[],!1,null,null,null);t.default=r.exports}}]);