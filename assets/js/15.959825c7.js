(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{306:function(e,r,t){e.exports=t.p+"assets/img/architecture.2ada1ece.png"},374:function(e,r,t){"use strict";t.r(r);var a=t(14),v=Object(a.a)({},(function(){var e=this,r=e._self._c;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"prometheus"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#prometheus"}},[e._v("#")]),e._v(" prometheus")]),e._v(" "),r("h2",{attrs:{id:"prometheus工作流程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#prometheus工作流程"}},[e._v("#")]),e._v(" Prometheus工作流程")]),e._v(" "),r("ol",[r("li",[e._v("Prometheus server可定期从活跃的（up）目标主机上（target）拉取监控指标数据，目标主机的监控数据可通过配置静态job或者服务发现的方式被prometheus server采集到，这种方式默认的pull方式拉取指标；也可通过pushgateway把采集的数据上报到prometheus server中；还可通过一些组件自带的exporter采集相应组件的数据；")]),e._v(" "),r("li",[e._v("Prometheus server把采集到的监控指标数据保存到本地磁盘或者数据库；")]),e._v(" "),r("li",[e._v("Prometheus采集的监控指标数据按时间序列存储，通过配置报警规则，把触发的报警发送到alertmanager")]),e._v(" "),r("li",[e._v("Alertmanager通过配置报警接收方，发送报警到邮件，微信或者钉钉等")]),e._v(" "),r("li",[e._v("Prometheus 自带的web ui界面提供PromQL查询语言，可查询监控数据")]),e._v(" "),r("li",[e._v("Grafana可接入prometheus数据源，把监控数据以图形化形式展示出")])]),e._v(" "),r("h2",{attrs:{id:"prometheus组件介绍"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#prometheus组件介绍"}},[e._v("#")]),e._v(" Prometheus组件介绍")]),e._v(" "),r("p",[e._v("1）Prometheus Server: 用于收集和存储时间序列数据。")]),e._v(" "),r("p",[e._v("2）Client Library: 客户端库，检测应用程序代码，当Prometheus抓取实例的HTTP端点时，客户端库会将所有跟踪的metrics指标的当前状态发送到prometheus server端。")]),e._v(" "),r("p",[e._v("3）Exporters: prometheus支持多种exporter，通过exporter可以采集metrics数据，然后发送到prometheus server端，所有向promtheus server提供监控数据的程序都可以被称为exporter")]),e._v(" "),r("p",[e._v("4）Alertmanager: 从 Prometheus server 端接收到 alerts 后，会进行去重，分组，并路由到相应的接收方，发出报警，常见的接收方式有：电子邮件，微信，钉钉, slack等。")]),e._v(" "),r("p",[e._v("5）Grafana：监控仪表盘，可视化监控数据")]),e._v(" "),r("p",[e._v("6）pushgateway: 各个目标主机可上报数据到pushgateway，然后prometheus server统一从pushgateway拉取数据。")]),e._v(" "),r("p",[r("img",{attrs:{src:t(306),alt:""}})]),e._v(" "),r("p",[e._v("从上图可发现，Prometheus整个生态圈组成主要包括"),r("code",[e._v("prometheus server")]),e._v("，"),r("code",[e._v("Exporter")]),e._v("，"),r("code",[e._v("pushgateway")]),e._v("，"),r("code",[e._v("alertmanager")]),e._v("，"),r("code",[e._v("grafana")]),e._v("，"),r("code",[e._v("Web ui")]),e._v("界面")]),e._v(" "),r("p",[r("code",[e._v("Prometheus server")]),e._v("由三个部分组成，"),r("code",[e._v("Retrieval")]),e._v("，"),r("code",[e._v("Storage")]),e._v("，"),r("code",[e._v("PromQL")])]),e._v(" "),r("ul",[r("li",[e._v("Retrieval负责在活跃的target主机上抓取监控指标数据")]),e._v(" "),r("li",[e._v("Storage存储主要是把采集到的数据存储到磁盘中")]),e._v(" "),r("li",[e._v("PromQL是Prometheus提供的查询语言模块。")])]),e._v(" "),r("blockquote",[r("p",[e._v("下面是组件详细介绍")])]),e._v(" "),r("h3",{attrs:{id:"job-exporter"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#job-exporter"}},[e._v("#")]),e._v(" job/exporter")]),e._v(" "),r("p",[e._v("Job/Exporter属于Prometheus target，是Prometheus监控的对\n象")]),e._v(" "),r("p",[e._v("Job分为两种：")]),e._v(" "),r("ul",[r("li",[e._v("长时间执行：可以使用Prometheus Client集成进行监控；")]),e._v(" "),r("li",[e._v("短时间执行：可以将监控数据推送到Pushgateway中缓存。")])]),e._v(" "),r("h3",{attrs:{id:"pushgateway"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#pushgateway"}},[e._v("#")]),e._v(" pushgateway")]),e._v(" "),r("p",[e._v("Prometheus是拉模式为主的监控系统，它的推模式就是通过\nPushgateway组件实现的。Pushgateway是支持临时性Job主动推送指标\n的中间网关，它本质上是一种用于监控Prometheus服务器无法抓取的\n资源的解决方案。")]),e._v(" "),r("blockquote",[r("p",[e._v("被监控的数据推送过程：\n被采集监控指标的应用程序->pushgateway->prometheus server")])]),e._v(" "),r("p",[e._v("使用场景：")]),e._v(" "),r("ul",[r("li",[e._v("临时/短作业")]),e._v(" "),r("li",[e._v("批处理作业")])]),e._v(" "),r("p",[e._v("自身问题：存在单点故障问题，宕机后将失去所有来源的监控")]),e._v(" "),r("p",[e._v("优点："),r("strong",[e._v("不会自动删除任何指标数据")]),e._v("，因此必须使用pushgateway的api从推送网关中删除过期的指标。")]),e._v(" "),r("div",{staticClass:"language-bash extra-class"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" "),r("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-X")]),e._v(" DELETE http://pushgateway.example.org:9091/metrics/job/some_job/instance/some_instance\n")])])]),r("h2",{attrs:{id:"配置告警"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#配置告警"}},[e._v("#")]),e._v(" 配置告警")]),e._v(" "),r("p",[e._v("前面提到的"),r("code",[e._v("alertmanager.yml")]),e._v("配置文件默认是不存在的，需要新\n建。这个文件主要是设置告警方式的，比如邮件、钉钉（webhook）、\n微信、pagerduty等方式。")]),e._v(" "),r("p",[e._v("它的选项主要有 "),r("code",[e._v("email_config")]),e._v("、\n"),r("code",[e._v("hipchat_config")]),e._v("、"),r("code",[e._v("pagerduty_config")]),e._v("、"),r("code",[e._v("pushover_config")]),e._v("、\n"),r("code",[e._v("slack_config")]),e._v("、"),r("code",[e._v("opsgenie_config")]),e._v("、"),r("code",[e._v("victorops_config")]),e._v("等。")]),e._v(" "),r("p",[e._v("docker更换阿里源")])])}),[],!1,null,null,null);r.default=v.exports}}]);